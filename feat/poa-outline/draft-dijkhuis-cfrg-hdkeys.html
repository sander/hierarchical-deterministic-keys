<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Hierarchical Deterministic Keys</title>
<meta content="Sander Dijkhuis" name="author">
<meta content="
       Hierarchical Deterministic Keys enables managing large sets of keys bound to a secure cryptographic device that protects a single key. This enables the development of secure digital identity wallets providing many one-time-use public keys. 
    " name="description">
<meta content="xml2rfc 3.23.1" name="generator">
<meta content="KDF" name="keyword">
<meta content="draft-dijkhuis-cfrg-hdkeys-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.23.1
    Python 3.12.6
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.4
    lxml 4.9.4
    platformdirs 4.3.6
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.32.3
    setuptools 70.3.0
    wcwidth 0.2.13
-->
<link href="draft-dijkhuis-cfrg-hdkeys.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">HDK</td>
<td class="right">September 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">Dijkhuis</td>
<td class="center">Expires 30 March 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Crypto Forum</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-dijkhuis-cfrg-hdkeys-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2024-09-26" class="published">26 September 2024</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-03-30">30 March 2025</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">S. Q. Dijkhuis, <span class="editor">Ed.</span>
</div>
<div class="org">Cleverbase</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Hierarchical Deterministic Keys</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">Hierarchical Deterministic Keys enables managing large sets of keys bound to a secure cryptographic device that protects a single key. This enables the development of secure digital identity wallets providing many one-time-use public keys.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-dijkhuis-cfrg-hdkeys/">https://datatracker.ietf.org/doc/draft-dijkhuis-cfrg-hdkeys/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/sander/hierarchical-deterministic-keys">https://github.com/sander/hierarchical-deterministic-keys</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 30 March 2025.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and definitions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-the-hierarchical-determinis" class="internal xref">The Hierarchical Deterministic Keys algorithm</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-introductory-examples" class="internal xref">Introductory examples</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.1">
                    <p id="section-toc.1-1.2.2.1.2.1.1" class="keepWithNext"><a href="#section-2.1.1" class="auto internal xref">2.1.1</a>.  <a href="#name-local-key-derivation-exampl" class="internal xref">Local key derivation example</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.2">
                    <p id="section-toc.1-1.2.2.1.2.2.1"><a href="#section-2.1.2" class="auto internal xref">2.1.2</a>.  <a href="#name-remote-key-derivation-examp" class="internal xref">Remote key derivation example</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.3">
                    <p id="section-toc.1-1.2.2.1.2.3.1"><a href="#section-2.1.3" class="auto internal xref">2.1.3</a>.  <a href="#name-blinding-example" class="internal xref">Blinding example</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="auto internal xref">2.2</a>.  <a href="#name-instantiation-parameters" class="internal xref">Instantiation parameters</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="auto internal xref">2.3</a>.  <a href="#name-the-hdk-root-function" class="internal xref">The HDK-Root function</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a href="#section-2.4" class="auto internal xref">2.4</a>.  <a href="#name-the-hdk-derive-local-functi" class="internal xref">The HDK-Derive-Local function</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.5">
                <p id="section-toc.1-1.2.2.5.1"><a href="#section-2.5" class="auto internal xref">2.5</a>.  <a href="#name-the-hdk-seed-remote-functio" class="internal xref">The HDK-Seed-Remote function</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.6">
                <p id="section-toc.1-1.2.2.6.1"><a href="#section-2.6" class="auto internal xref">2.6</a>.  <a href="#name-the-hdk-derive-remote-funct" class="internal xref">The HDK-Derive-Remote function</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.7">
                <p id="section-toc.1-1.2.2.7.1"><a href="#section-2.7" class="auto internal xref">2.7</a>.  <a href="#name-the-hdk-authenticate-functi" class="internal xref">The HDK-Authenticate function</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-generic-hdk-instantiations" class="internal xref">Generic HDK instantiations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-using-elliptic-curves" class="internal xref">Using elliptic curves</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-using-ecdh-message-authenti" class="internal xref">Using ECDH message authentication codes for proof of possession</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-using-ec-sdsa-signatures-fo" class="internal xref">Using EC-SDSA signatures for proof of possession</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="auto internal xref">3.4</a>.  <a href="#name-using-ecdsa-signatures-for-" class="internal xref">Using ECDSA signatures for proof of possession</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-concrete-hdk-instantiations" class="internal xref">Concrete HDK instantiations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-hdk-ecdh-p256" class="internal xref">HDK-ECDH-P256</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-hdk-ecsdsa-p256" class="internal xref">HDK-ECSDSA-P256</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-application-considerations" class="internal xref">Application considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-secure-cryptographic-device" class="internal xref">Secure cryptographic device</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-trust-evidence" class="internal xref">Trust evidence</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.1">
                    <p id="section-toc.1-1.5.2.2.2.1.1"><a href="#section-5.2.1" class="auto internal xref">5.2.1</a>.  <a href="#name-wallet-trust-evidence" class="internal xref">Wallet Trust Evidence</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.2">
                    <p id="section-toc.1-1.5.2.2.2.2.1"><a href="#section-5.2.2" class="auto internal xref">5.2.2</a>.  <a href="#name-issuer-trust-evidence" class="internal xref">Issuer Trust Evidence</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-applying-hdk-in-openid-for-" class="internal xref">Applying HDK in OpenID for Verifiable Credential Issuance</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-security-considerations" class="internal xref">Security considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-confidentiality-of-key-hand" class="internal xref">Confidentiality of key handles</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-acknowledgements" class="internal xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This document specifies the algorithms to apply Hierarchical Deterministic Keys (HDKs). The purpose of an HDK architecture is to manage large sets of keys bound to a secure cryptographic device that protects a single key. This enables the development of secure digital identity wallets providing many one-time-use public keys.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">The core idea has been introduced in <span>[<a href="#BIP32" class="cite xref">BIP32</a>]</span> to create multiple cryptocurrency addresses in a manageable way. The present document extends the idea towards devices commonly used for digital wallets, and towards common interaction patterns for document issuance and authentication.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">To store many HDKs, only a seed string needs to be securely stored, associated with the device private key. Each HDK is then deterministically defined by a path of self-generated indices or provided key handles. Such a path can efficiently be stored and requires less confidentiality than the seed.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">To prove possession of many HDKs, the secure cryptographic device only needs to perform common cryptographic operations on a single key. The HDK acts as a blinding factor that enables blinding the device public key.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">This document provides a specification of the generic HDK scheme, generic HDK instantiations, and fully specified concrete HDK instantiations.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">An HDK instantiation is expected to be applied in a solution deployed as (wallet) solution instances. One solution instance can have multiple HDK instantiations, for example to manage multiple identities or multiple cryptographic algorithms or key protection mechanisms.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">This document represents the consensus of the authors, based on working group input and feedback. It is not a standard. It does not include security or privacy proofs.<a href="#section-1-7" class="pilcrow">¶</a></p>
<div id="conventions-and-definitions">
<section id="section-1.1">
        <h3 id="name-conventions-and-definitions">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and definitions</a>
        </h3>
<p id="section-1.1-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">The following notation is used throughout the document.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-3.1">
            <p id="section-1.1-3.1.1">byte: A sequence of eight bits.<a href="#section-1.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-3.2">
            <p id="section-1.1-3.2.1"><code>I2OSP(n, w)</code>: Convert non-negative integer <code>n</code> to a <code>w</code>-length, big-endian byte string, as described in <span>[<a href="#RFC8017" class="cite xref">RFC8017</a>]</span>.<a href="#section-1.1-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="the-hierarchical-deterministic-keys-algorithm">
<section id="section-2">
      <h2 id="name-the-hierarchical-determinis">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-the-hierarchical-determinis" class="section-name selfRef">The Hierarchical Deterministic Keys algorithm</a>
      </h2>
<p id="section-2-1">An HDK instantiation applies local key derivation to create many key pairs from a single seed value. It applies asynchronous remote key generation to enable providers to derive more key pairs. Additionally, an HDK instantiation applies these key pairs to blind a single key pair and proofs of its possession, such as required in <span>[<a href="#RFC7800" class="cite xref">RFC7800</a>]</span>.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">Solutions <span class="bcp14">MAY</span> omit application of the asynchronous remote key generation functionality. In this case, a solution instance can only derive keys locally.<a href="#section-2-2" class="pilcrow">¶</a></p>
<div id="introductory-examples">
<section id="section-2.1">
        <h3 id="name-introductory-examples">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-introductory-examples" class="section-name selfRef">Introductory examples</a>
        </h3>
<div id="local-key-derivation-example">
<section id="section-2.1.1">
          <h4 id="name-local-key-derivation-exampl">
<a href="#section-2.1.1" class="section-number selfRef">2.1.1. </a><a href="#name-local-key-derivation-exampl" class="section-name selfRef">Local key derivation example</a>
          </h4>
<p id="section-2.1.1-1">The following example illustrates the use of key derivation. An HDK tree is defined by an initial public key and a seed value, which is a byte array containing sufficient entropy. Now tree nodes are constructed as follows.<a href="#section-2.1.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.1.1-2">
<pre>
              +------------------------+
              |Confidential static data|
              |+---------+ +----+      |
              ||pk_device| |seed|      |
              |+----+----+ +--+-+      |
              +-----+---------+--------+
  +-----------------+---------+---------------------------+
  |Level 0          v         v                           |
  |+-----------------------------------------------------+|
  ||(pk0, sdk0, salt0) = hdk0 = HDK-Root(pk_device, seed)||
  |+----+------------------------------------------------+|
  +-----+-------------------------------------------------+
Level 1 v
+-------------------------++-----------------++-----------------+
|(pk1, sk1, salt1) =      ||HDK-Derive-Local(||HDK-Derive-Local(|
|HDK-Derive-Local(hdk0, 0)||    hdk0, 1)     ||    hdk0, 2)     |
+-----------+--------+----++-----------------++-----------------+
            |        +---------------+
            |                        |
+-----------+------------------------+--------------------+
|Level 2    v                        v                    |
|+-----------------------++-----------------------+       |
||HDK-Derive-Local(      ||HDK-Derive-Local(      |       |
||    (pk1,sk1,salt1), 0)||    (pk1,sk1,salt1), 1)|       |
|+-----------------------++-----------------------+       |
+---------------------------------------------------------+
</pre><a href="#section-2.1.1-2" class="pilcrow">¶</a>
</div>
<p id="section-2.1.1-3">The solution instance computes the Level 0 HDK at the root node using a deterministic function called HDK-Root. The HDK consists of a key pair <code>(pk0, sk0)</code>, and a byte string <code>salt0</code> to derive next-level keys.<a href="#section-2.1.1-3" class="pilcrow">¶</a></p>
<p id="section-2.1.1-4">The solution instance computes the Level <code>n &gt; 0</code> value is using a deterministic function called HDK-Derive-Local. The function takes the previous-level salt as input, and a sequence number <code>i</code> starting at 0. The function returns a new HDK as output.<a href="#section-2.1.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="remote-key-derivation-example">
<section id="section-2.1.2">
          <h4 id="name-remote-key-derivation-examp">
<a href="#section-2.1.2" class="section-number selfRef">2.1.2. </a><a href="#name-remote-key-derivation-examp" class="section-name selfRef">Remote key derivation example</a>
          </h4>
<p id="section-2.1.2-1">Instead of a locally generated index, an HDK can also be derived using a key handle as per Asynchronous Remote Key Generation (ARKG) <span>[<a href="#I-D.draft-bradleylundberg-cfrg-arkg-02" class="cite xref">I-D.draft-bradleylundberg-cfrg-arkg-02</a>]</span>. To enable ARKG, the solution instance uses HDK-Seed-Remote and provides the output public key to an issuer. The issuer returns a key handle, using which the solution instance can derive a next-level key pair and seed using HDK-Derive-Remote.<a href="#section-2.1.2-1" class="pilcrow">¶</a></p>
<p id="section-2.1.2-2">Locally derived parents can have remotely derived children. Remotely derived parents can have locally derived children.<a href="#section-2.1.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="blinding-example">
<section id="section-2.1.3">
          <h4 id="name-blinding-example">
<a href="#section-2.1.3" class="section-number selfRef">2.1.3. </a><a href="#name-blinding-example" class="section-name selfRef">Blinding example</a>
          </h4>
<p id="section-2.1.3-1">The next concept to illustrate is blinding. Blinding enables a solution instance to prove possession of a private key without disclosing the directly associated public key. This way, solutions can avoid linkability across readers of a document that is released with proof of possession.<a href="#section-2.1.3-1" class="pilcrow">¶</a></p>
<p id="section-2.1.3-2">In this example, a document is issued in such a way that it can be presented with proof of possession using <code>pk</code> as derived using HDK. The solution instance applies the HDK-Authenticate function to the associated <code>sk</code> along with the device private key <code>sk_device</code> and reader-provided <code>reader_data</code>. The output is <code>device_data</code>, which the solution instance can subsequently use to prove possession to the reader. The reader does not need to be aware that HDK was used.<a href="#section-2.1.3-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.1.3-3">
<pre>
In secure
cryptographic
device
+-----------+
|sk_device  +-------------+
+-----------+             |
-------------             |
HDK in                    |
solution                  |
instance                  v        +-----------+
+-----------+    HDK-Authenticate-&gt;|device_data|
|pk         |       ^     ^        +-----------+
+-----------+       |     |
+-----------+       |     |
|sk         +-------+     |
+-----------+             |
-------------             |
+-----------+             |
|reader_data+-------------+
+-----------+
</pre><a href="#section-2.1.3-3" class="pilcrow">¶</a>
</div>
<p id="section-2.1.3-4">Blinding methods can be constructed such that the secure cryptographic device does not need to be designed for it. In such cases, <code>sk_device</code> does not contain the value of the private device key but a reference to it.<a href="#section-2.1.3-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="instantiation-parameters">
<section id="section-2.2">
        <h3 id="name-instantiation-parameters">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-instantiation-parameters" class="section-name selfRef">Instantiation parameters</a>
        </h3>
<p id="section-2.2-1">The parameters of an HDK instantiation are:<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2-2.1">
            <p id="section-2.2-2.1.1"><code>ID</code>: A domain separation tag, represented as a string of ASCII bytes.<a href="#section-2.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.2-2.2">
            <p id="section-2.2-2.2.1"><code>Nk</code>: The amount of bytes needed to create a uniformly random key. Note that <code>Nk</code> usually needs to be higher than the size of the key space, for example to maintain uniform distribution when deriving RNG({1,2,...,n-1}) from RNG({0,1,2,...,2^k-1}) for <code>k=8*Nk</code> and <code>2^k &gt;= n</code> as per <span>[<a href="#TR03111" class="cite xref">TR03111</a>]</span> Section 4.1.1 Algorithm 2.<a href="#section-2.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.2-2.3">
            <p id="section-2.2-2.3.1"><code>Ns</code>: The amount of bytes of a salt value with sufficient entropy.<a href="#section-2.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.2-2.4">
            <p id="section-2.2-2.4.1"><code>key(bytes)</code>: Deterministically outputs a key pair <code>(pk, sk)</code> from a uniformly random string of <code>Nk</code> bytes.<a href="#section-2.2-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.2-2.5">
            <p id="section-2.2-2.5.1"><code>serialize(pk)</code>: Serializes a public key <code>pk</code> to a fixed-size string.<a href="#section-2.2-2.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.2-2.6">
            <p id="section-2.2-2.6.1"><code>expand(msg, DST, L)</code>: Outputs a uniformly random string of <code>L</code> bytes using a cryptographic hash or extendable-output function and input byte strings <code>msg</code> and <code>DST</code>.<a href="#section-2.2-2.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.2-2.7">
            <p id="section-2.2-2.7.1"><code>BL</code>: An asymmetric key blinding scheme <span>[<a href="#I-D.draft-bradleylundberg-cfrg-arkg-02" class="cite xref">I-D.draft-bradleylundberg-cfrg-arkg-02</a>]</span>, consisting of the functions:<a href="#section-2.2-2.7.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2-2.7.2.1">
                <p id="section-2.2-2.7.2.1.1">BL-Blind-Public-Key(pk, tau, info): Outputs <code>pk</code> blinded with blinding factor <code>tau</code> and domain separation parameter <code>info</code>, both byte strings.<a href="#section-2.2-2.7.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2-2.7.2.2">
                <p id="section-2.2-2.7.2.2.1">BL-Blind-Private-Key(sk, tau, info): Outputs <code>sk</code> blinded with blinding factor <code>tau</code> and domain separation parameter <code>info</code>, both byte strings.<a href="#section-2.2-2.7.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-2.2-2.8">
            <p id="section-2.2-2.8.1"><code>ARKG</code>: An asynchronous remote key generation instantiation <span>[<a href="#I-D.draft-bradleylundberg-cfrg-arkg-02" class="cite xref">I-D.draft-bradleylundberg-cfrg-arkg-02</a>]</span>, encapsulating an asymmetric key blinding scheme instantiation <code>BL</code> and a key encapsulation mechanism <code>KEM</code>, and consisting of the functions:<a href="#section-2.2-2.8.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2-2.8.2.1">
                <p id="section-2.2-2.8.2.1.1">ARKG-Derive-Public-Key(pk, info): Outputs <code>(pk', kh)</code> where <code>pk'</code> is a derived public key and <code>kh</code> is a key handle to derive the associated private key, based on an ARKG public seed <code>pk = (pk_kem, pk_bl)</code> and application-specific information <code>info</code>.<a href="#section-2.2-2.8.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2-2.8.2.2">
                <p id="section-2.2-2.8.2.2.1">ARKG-Derive-Private-Key(sk, kh, info): Outputs <code>sk'</code>, a blinded private key Scalar based on ARKG private seed <code>sk = (sk_kem, sk_bl)</code>, a key handle <code>kh</code>, and application-specific information <code>info</code>.<a href="#section-2.2-2.8.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-2.2-2.9">
            <p id="section-2.2-2.9.1"><code>HDK-Root(pk_device, seed)</code>: See <span><a href="#the-hdk-root-function" class="internal xref">The HDK-Root function</a> (<a href="#the-hdk-root-function" class="auto internal xref">Section 2.3</a>)</span>.<a href="#section-2.2-2.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.2-2.10">
            <p id="section-2.2-2.10.1"><code>HDK-Derive-Remote(pk_device, (pk, sk, salt), kh)</code>: See <span><a href="#the-hdk-derive-remote-function" class="internal xref">The HDK-Derive-Remote function</a> (<a href="#the-hdk-derive-remote-function" class="auto internal xref">Section 2.6</a>)</span>.<a href="#section-2.2-2.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.2-2.11">
            <p id="section-2.2-2.11.1"><code>HDK-Authenticate(sk_device, sk_hdk, reader_data)</code>: See <span><a href="#the-hdk-authenticate-function" class="internal xref">The HDK-Authenticate function</a> (<a href="#the-hdk-authenticate-function" class="auto internal xref">Section 2.7</a>)</span>.<a href="#section-2.2-2.11.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.2-3">A concrete HDK instantiation <span class="bcp14">MUST</span> specify the instantiation of each of the above functions and values.<a href="#section-2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="the-hdk-root-function">
<section id="section-2.3">
        <h3 id="name-the-hdk-root-function">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-the-hdk-root-function" class="section-name selfRef">The HDK-Root function</a>
        </h3>
<p id="section-2.3-1">A solution instance creates a root HDK using a seed and a device public key. The generation of the seed is out of scope for this specification.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.3-2">
<pre>
Inputs:
- pk_device, a device public key.
- seed, a string of Ns bytes.

Outputs:
- pk, the root public key.
- sk, the root private key.
- salt, the root salt.

def HDK-Root(pk_device, seed)
</pre><a href="#section-2.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="the-hdk-derive-local-function">
<section id="section-2.4">
        <h3 id="name-the-hdk-derive-local-functi">
<a href="#section-2.4" class="section-number selfRef">2.4. </a><a href="#name-the-hdk-derive-local-functi" class="section-name selfRef">The HDK-Derive-Local function</a>
        </h3>
<p id="section-2.4-1">A solution instance derives a key pair and a salt from an HDK and an index.<a href="#section-2.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.4-2">
<pre>
Inputs:
- pk, a public key.
- sk, a private key.
- salt, a string of Ns bytes.
- index, an integer between 0 and 2^32-1 (inclusive).

Outputs:
- pk', the next-level public key at the provided index.
- sk', the next-level private key at the provided index.
- salt', the next-level salt at the provided index.

def HDK-Derive-Local((pk, sk, salt), index):
    msg = serialize(pk) || I2OSP(index, 4)
    okm = expand(msg, ID || salt, Nk + Ns)
    tau = okm[0:Nk]
    info = "HDK-Derive-Local"
    sk' = BL-Blind-Private-Key(sk, tau, info)
    pk' = BL-Blind-Public-Key(pk, tau, info)
    salt' = okm[Nk:]
    return (pk', sk', salt')
</pre><a href="#section-2.4-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="the-hdk-seed-remote-function">
<section id="section-2.5">
        <h3 id="name-the-hdk-seed-remote-functio">
<a href="#section-2.5" class="section-number selfRef">2.5. </a><a href="#name-the-hdk-seed-remote-functio" class="section-name selfRef">The HDK-Seed-Remote function</a>
        </h3>
<p id="section-2.5-1">A solution instance derives an ARKG seed from an HDK.<a href="#section-2.5-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.5-2">
<pre>
Inputs:
- pk, a public key.
- sk, a private key.
- salt, a string of Ns bytes.

Outputs:
- pk', an ARKG public seed.
- sk', an ARKG private seed.

def HDK-Seed-Remote((pk, sk, salt)):
    okm = expand("seed", ID || salt, Nk)
    (pk_kem, sk_kem) = key(okm)
    pk_bl = pk
    sk_bl = sk
    return ((pk_kem, pk_bl), (sk_kem, sk_bl))
</pre><a href="#section-2.5-2" class="pilcrow">¶</a>
</div>
<p id="section-2.5-3">Given an ARKG public seed <code>pk</code>, an issuer can derive an ARKG key handle <code>kh</code> and blinded public key <code>pk'</code> using:<a href="#section-2.5-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.5-4">
<pre>
(pk', kh) = ARKG-Derive-Public-Key(pk, "")
</pre><a href="#section-2.5-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="the-hdk-derive-remote-function">
<section id="section-2.6">
        <h3 id="name-the-hdk-derive-remote-funct">
<a href="#section-2.6" class="section-number selfRef">2.6. </a><a href="#name-the-hdk-derive-remote-funct" class="section-name selfRef">The HDK-Derive-Remote function</a>
        </h3>
<p id="section-2.6-1">A solution instance derives a key pair and a salt from an HDK and an ARKG key handle.<a href="#section-2.6-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.6-2">
<pre>
Inputs:
- pk_device, the device public key.
- pk, a public key.
- sk, a private key.
- salt, a string of Ns bytes.
- kh, an ARKG key handle.

Outputs:
- pk', the next-level public key for the provided key handle.
- sk', the next-level private key for the provided key handle.
- salt', the next-level salt for the provided key handle.

def HDK-Derive-Remote(pk_device, (pk, sk, salt), kh)
</pre><a href="#section-2.6-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="the-hdk-authenticate-function">
<section id="section-2.7">
        <h3 id="name-the-hdk-authenticate-functi">
<a href="#section-2.7" class="section-number selfRef">2.7. </a><a href="#name-the-hdk-authenticate-functi" class="section-name selfRef">The HDK-Authenticate function</a>
        </h3>
<p id="section-2.7-1">A solution instance authenticates the device by creating a blinded proof applying the device private key and an HDK private key. This yields device data which it can use to prove possession of the device-bound document. The application-specific data for proof of possession is out of scope for HDK.<a href="#section-2.7-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.7-2">
<pre>
Inputs:
- sk_device, a (reference to a) device private key.
- sk_hdk, an HDK private key.
- reader_data, a byte string of solution instance-specific data.

Outputs:
- device_data, a byte string of device data for proving possession.

def HDK-Authenticate(sk_device, sk_hdk, reader_data)
</pre><a href="#section-2.7-2" class="pilcrow">¶</a>
</div>
<p id="section-2.7-3">Implementations of this function typically perform pre-processing on the <code>reader_data</code>, invoke the device key operation on the result, and perform post-processing on the output.<a href="#section-2.7-3" class="pilcrow">¶</a></p>
<p id="section-2.7-4">A HDK instantiation <span class="bcp14">MUST</span> define HDK-Authenticate such that the <code>device_data</code> can be verified using the public key in the same HDK as <code>sk_hdk</code>. The reader does not need to know that HDK was applied: the public key will look like any other public key used for proofs of possession.<a href="#section-2.7-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="generic-hdk-instantiations">
<section id="section-3">
      <h2 id="name-generic-hdk-instantiations">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-generic-hdk-instantiations" class="section-name selfRef">Generic HDK instantiations</a>
      </h2>
<div id="using-elliptic-curves">
<section id="section-3.1">
        <h3 id="name-using-elliptic-curves">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-using-elliptic-curves" class="section-name selfRef">Using elliptic curves</a>
        </h3>
<p id="section-3.1-1">Instantiations of HDK using elliptic curves requires the following cryptographic construct:<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-2.1">
            <p id="section-3.1-2.1.1"><code>EC</code>: An elliptic curve with elements of type Element and scalars of type Scalar, consisting of the functions:<a href="#section-3.1-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-2.1.2.1">
                <p id="section-3.1-2.1.2.1.1">EC-Add(A, B): Outputs the sum between Elements <code>A</code> and <code>B</code>.<a href="#section-3.1-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-3.1-2.1.2.2">
                <p id="section-3.1-2.1.2.2.1">EC-Scalar-Mult(A, k): Outputs the scalar multiplication between Element <code>A</code> and Scalar <code>k</code>.<a href="#section-3.1-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-3.1-2.1.2.3">
                <p id="section-3.1-2.1.2.3.1">EC-Scalar-Base-Mult(k): Outputs the scalar multiplication between the base Element and Scalar <code>k</code>.<a href="#section-3.1-2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-3.1-2.1.2.4">
                <p id="section-3.1-2.1.2.4.1">EC-Order(): Outputs the order of the base Element.<a href="#section-3.1-2.1.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-3.1-2.1.2.5">
                <p id="section-3.1-2.1.2.5.1">EC-Serialize-Element(A): Outputs a byte string representing Element <code>A</code>.<a href="#section-3.1-2.1.2.5.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="section-3.1-3">These instantiations instantiate the following:<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-4">
<pre>
def serialize(pk):
    return EC-Serialize-Element(pk)

def key(bytes):
    sk' = OS2IP(bytes) mod (EC-Order() - 1)
    sk = sk' + 1
    pk = EC-Scalar-Base-Mult(sk)
    return (pk, sk)
</pre><a href="#section-3.1-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="using-ecdh-message-authentication-codes-for-proof-of-possession">
<section id="section-3.2">
        <h3 id="name-using-ecdh-message-authenti">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-using-ecdh-message-authenti" class="section-name selfRef">Using ECDH message authentication codes for proof of possession</a>
        </h3>
<p id="section-3.2-1">Such instantiations of HDK use elliptic curves (see <span><a href="#using-elliptic-curves" class="internal xref">Using elliptic curves</a> (<a href="#using-elliptic-curves" class="auto internal xref">Section 3.1</a>)</span>) and require the following cryptographic construct:<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-2.1">
            <p id="section-3.2-2.1.1"><code>ECDH</code>: An Elliptic Curve Key Agreement Algorithm - Diffie-Hellman (ECKA-DH) <span>[<a href="#TR03111" class="cite xref">TR03111</a>]</span> with elliptic curve <code>EC</code>, consisting of the functions:<a href="#section-3.2-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-2.1.2.1">
                <p id="section-3.2-2.1.2.1.1">ECDH-Create-Shared-Secret(sk_self, pk_other): Outputs a shared secret byte string representing an Element.<a href="#section-3.2-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="section-3.2-3">In such instantiations, the reader provides an ephemeral public key <code>reader_data</code>. The HDK-Authenticate function returns <code>device_data</code> consisting of a binary encoded x-coordinate <code>Z_AB</code> of an ECDH operation with <code>sk_device</code> and <code>sk_hdk</code>. Subsequently, the solution instance creates a message authentication code (MAC), such as in ECDH-MAC authentication defined in <span>[<a href="#ISO18013-5" class="cite xref">ISO18013-5</a>]</span>. The reader verifies this MAC by performing an ECDH operation with its ephemeral private key and the HDK public key.<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<p id="section-3.2-4">These instantiations instantiate the following:<a href="#section-3.2-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.2-5">
<pre>
def HDK-Root(pk_device, seed):
    msg = serialize(pk_device)
    okm = expand(msg, ID || seed, Nk + Ns)
    (_, sk') = key(okm[0:Nk])
    pk' = EC-Scalar-Mult(pk_device, sk')
    salt' = okm[Nk:]
    return (pk', sk', salt')

def HDK-Derive-Remote(pk_device, (pk, sk, salt), kh):
    (pk_arkg, sk_arkg) = HDK-Seed-Remote((pk, sk, salt))
    sk' = ARKG-Derive-Private-Key(sk_arkg, kh, "")
    pk' = EC-Scalar-Mult(pk_device, sk')
    msg = serialize(pk')
    salt' = expand(msg, ID || salt, Ns)
    return (pk', sk', salt')

def HDK-Authenticate(sk_device, sk_hdk, reader_data):
    P' = EC-Scalar-Mult(reader_data, sk_hdk)

    # Compute Z_AB within the secure cryptographic device.
    Z_AB = ECDH-Create-Shared-Secret(sk_device, P')

    return Z_AB
</pre><a href="#section-3.2-5" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="using-ec-sdsa-signatures-for-proof-of-possession">
<section id="section-3.3">
        <h3 id="name-using-ec-sdsa-signatures-fo">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-using-ec-sdsa-signatures-fo" class="section-name selfRef">Using EC-SDSA signatures for proof of possession</a>
        </h3>
<p id="section-3.3-1">Such instantiations of HDK use elliptic curves (see <span><a href="#using-elliptic-curves" class="internal xref">Using elliptic curves</a> (<a href="#using-elliptic-curves" class="auto internal xref">Section 3.1</a>)</span>) require the following cryptographic construct:<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3-2.1">
            <p id="section-3.3-2.1.1"><code>DSA</code>: an EC-SDSA (Schnorr) digital signature algorithm <span>[<a href="#TR03111" class="cite xref">TR03111</a>]</span>, consisting of the functions:<a href="#section-3.3-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3-2.1.2.1">
                <p id="section-3.3-2.1.2.1.1">DSA-Sign(sk, message): Outputs the signature <code>(c, r)</code> created using private signing key <code>sk</code> over byte string <code>message</code>.<a href="#section-3.3-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-3.3-2.1.2.2">
                <p id="section-3.3-2.1.2.2.1">DSA-Verify(signature, pk, message): Outputs whether <code>signature</code> is a signature over <code>message</code> using public verification key <code>pk</code>.<a href="#section-3.3-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-3.3-2.1.2.3">
                <p id="section-3.3-2.1.2.3.1">DSA-Serialize(c, r): Outputs the byte array serialization of the signature <code>(c, r)</code>.<a href="#section-3.3-2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-3.3-2.1.2.4">
                <p id="section-3.3-2.1.2.4.1">DSA-Deserialize(bytes): Outputs the signature <code>(c, r)</code> represented by byte string <code>bytes</code>.<a href="#section-3.3-2.1.2.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="section-3.3-3">The reader <span class="bcp14">MUST</span> create an input byte string <code>reader_data</code> with sufficient entropy for each challenge.<a href="#section-3.3-3" class="pilcrow">¶</a></p>
<p id="section-3.3-4">The reader <span class="bcp14">MUST</span> verify the proof <code>device_data</code> using DSA-Verify with the HDK public key.<a href="#section-3.3-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.3-5">
<pre>
def HDK-Root(pk_device, seed):
    msg = serialize(pk_device)
    okm = expand(msg, ID || seed, Nk + Ns)
    (_, sk') = key(okm[0:Nk])
    pk' = EC-Add(pk_device, EC-Scalar-Base-Mult(sk'))
    salt' = okm[Nk:]
    return (pk', sk', salt')

def HDK-Derive-Remote(pk_device, (pk, sk, salt), kh):
    (pk_arkg, sk_arkg) = HDK-Seed-Remote((pk, sk, salt))
    sk' = ARKG-Derive-Private-Key(sk_arkg, kh, "")
    pk' = EC-Add(pk_device, EC-Scalar-Base-Mult(sk'))
    msg = serialize(pk')
    salt' = expand(msg, ID || salt, Ns)
    return (pk', sk', salt')

def HDK-Authenticate(sk_device, sk_hdk, reader_data):
    # Compute signature within the secure cryptographic device.
    signature = DSA-Sign(sk_device, reader_data)

    (c, s) = DSA-Deserialize(proof)
    s' = s + c * sk_hdk mod EC-Order()
    proof = DSA-Serialize(c, s')
    return proof
</pre><a href="#section-3.3-5" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="using-ecdsa-signatures-for-proof-of-possession">
<section id="section-3.4">
        <h3 id="name-using-ecdsa-signatures-for-">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-using-ecdsa-signatures-for-" class="section-name selfRef">Using ECDSA signatures for proof of possession</a>
        </h3>
<p id="section-3.4-1">Due to potential patent claims and potential related-key attacks, this document does not specify an implementation for threshold ECDSA.<a href="#section-3.4-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="concrete-hdk-instantiations">
<section id="section-4">
      <h2 id="name-concrete-hdk-instantiations">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-concrete-hdk-instantiations" class="section-name selfRef">Concrete HDK instantiations</a>
      </h2>
<p id="section-4-1">The <span class="bcp14">RECOMMENDED</span> instantiation is the HDK-ECDH-P256. This avoids the risk of having the holder unknowingly producing a potentially non-repudiable signature over reader-provided data. Secure cryptographic devices that enable a high level of assurance typically support managing ECDH keys with the P-256 elliptic curve.<a href="#section-4-1" class="pilcrow">¶</a></p>
<div id="hdk-ecdh-p256">
<section id="section-4.1">
        <h3 id="name-hdk-ecdh-p256">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-hdk-ecdh-p256" class="section-name selfRef">HDK-ECDH-P256</a>
        </h3>
<p id="section-4.1-1">This instantiation uses ECDH (see <span><a href="#using-ecdh-message-authentication-codes-for-proof-of-possession" class="internal xref">Using ECDH message authentication codes for proof of possession</a> (<a href="#using-ecdh-message-authentication-codes-for-proof-of-possession" class="auto internal xref">Section 3.2</a>)</span>).<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-2.1">
            <p id="section-4.1-2.1.1"><code>ID</code>: <code>"HDK-ECDH-P256-v1"</code><a href="#section-4.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-2.2">
            <p id="section-4.1-2.2.1"><code>Nr</code>: 48<a href="#section-4.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-2.3">
            <p id="section-4.1-2.3.1"><code>Ns</code>: 32<a href="#section-4.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-2.4">
            <p id="section-4.1-2.4.1"><code>expand</code>: <code>expand_message_xmd</code> from <span>[<a href="#RFC9380" class="cite xref">RFC9380</a>]</span> with:<a href="#section-4.1-2.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-2.4.2.1">
                <p id="section-4.1-2.4.2.1.1"><code>H</code>: SHA-256 <span>[<a href="#FIPS180-4" class="cite xref">FIPS180-4</a>]</span><a href="#section-4.1-2.4.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.1-2.4.2.2">
                <p id="section-4.1-2.4.2.2.1"><code>b_in_bytes</code>: 32<a href="#section-4.1-2.4.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.1-2.4.2.3">
                <p id="section-4.1-2.4.2.3.1"><code>s_in_bytes</code>: 64<a href="#section-4.1-2.4.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-4.1-2.5">
            <p id="section-4.1-2.5.1"><code>ARKG</code>: ARKG instantiation as described in <span>[<a href="#I-D.draft-bradleylundberg-cfrg-arkg-02" class="cite xref">I-D.draft-bradleylundberg-cfrg-arkg-02</a>]</span> with the identifier <code>ARKG-P256MUL-ECDH</code>, <code>KEM</code> as defined above, and <code>BL</code> with elliptic curve arithmetic as described in <span>[<a href="#I-D.draft-bradleylundberg-cfrg-arkg-02" class="cite xref">I-D.draft-bradleylundberg-cfrg-arkg-02</a>]</span> Section 3.1, but with multiplicative instead of additive blinding.<a href="#section-4.1-2.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-2.6">
            <p id="section-4.1-2.6.1"><code>EC</code>: The NIST curve <code>secp256r1</code> (P-256) <span>[<a href="#SEC2" class="cite xref">SEC2</a>]</span>.<a href="#section-4.1-2.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-2.7">
            <p id="section-4.1-2.7.1"><code>ECDH</code>: ECKA-DH with curve <code>EC</code><a href="#section-4.1-2.7.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.1-3">The holder <span class="bcp14">MUST</span> generate <code>sk_device</code> as an <code>ECDH</code> private key in the secure cryptographic device.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="hdk-ecsdsa-p256">
<section id="section-4.2">
        <h3 id="name-hdk-ecsdsa-p256">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-hdk-ecsdsa-p256" class="section-name selfRef">HDK-ECSDSA-P256</a>
        </h3>
<p id="section-4.2-1">This instantiation uses EC-SDSA (see <span><a href="#using-ec-sdsa-signatures-for-proof-of-possession" class="internal xref">Using EC-SDSA signatures for proof of possession</a> (<a href="#using-ec-sdsa-signatures-for-proof-of-possession" class="auto internal xref">Section 3.3</a>)</span>).<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-2.1">
            <p id="section-4.2-2.1.1"><code>ID</code>: <code>"HDK-ECSDSA-P256-v1"</code><a href="#section-4.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.2-2.2">
            <p id="section-4.2-2.2.1"><code>Nr</code>: 48<a href="#section-4.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.2-2.3">
            <p id="section-4.2-2.3.1"><code>Ns</code>: 32<a href="#section-4.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.2-2.4">
            <p id="section-4.2-2.4.1"><code>expand</code>: <code>expand_message_xmd</code> from <span>[<a href="#RFC9380" class="cite xref">RFC9380</a>]</span> with:<a href="#section-4.2-2.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-2.4.2.1">
                <p id="section-4.2-2.4.2.1.1"><code>H</code>: SHA-256 <span>[<a href="#FIPS180-4" class="cite xref">FIPS180-4</a>]</span><a href="#section-4.2-2.4.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.2-2.4.2.2">
                <p id="section-4.2-2.4.2.2.1"><code>b_in_bytes</code>: 32<a href="#section-4.2-2.4.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.2-2.4.2.3">
                <p id="section-4.2-2.4.2.3.1"><code>s_in_bytes</code>: 64<a href="#section-4.2-2.4.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-4.2-2.5">
            <p id="section-4.2-2.5.1"><code>ARKG</code>: ARKG instantiation as described in <span>[<a href="#I-D.draft-bradleylundberg-cfrg-arkg-02" class="cite xref">I-D.draft-bradleylundberg-cfrg-arkg-02</a>]</span> with the identifier <code>ARKG-P256ADD-ECDH</code>, <code>KEM</code> as defined above, and <code>BL</code> with elliptic curve arithmetic as described in <span>[<a href="#I-D.draft-bradleylundberg-cfrg-arkg-02" class="cite xref">I-D.draft-bradleylundberg-cfrg-arkg-02</a>]</span> Section 3.1.<a href="#section-4.2-2.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.2-2.6">
            <p id="section-4.2-2.6.1"><code>EC</code>: The NIST curve <code>secp256r1</code> (P-256) <span>[<a href="#SEC2" class="cite xref">SEC2</a>]</span>.<a href="#section-4.2-2.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.2-2.7">
            <p id="section-4.2-2.7.1"><code>DSA</code>: EC-SDSA-opt (the optimised EC-SDSA) with curve <code>EC</code>.<a href="#section-4.2-2.7.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.2-3">The holder <span class="bcp14">MUST</span> generate <code>sk_device</code> as a <code>DSA</code> private key in the secure cryptographic device.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="application-considerations">
<section id="section-5">
      <h2 id="name-application-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-application-considerations" class="section-name selfRef">Application considerations</a>
      </h2>
<div id="secure-cryptographic-device">
<section id="section-5.1">
        <h3 id="name-secure-cryptographic-device">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-secure-cryptographic-device" class="section-name selfRef">Secure cryptographic device</a>
        </h3>
<p id="section-5.1-1">The HDK algorithm assumes that the holder controls a secure cryptographic device that protects the device key pair <code>(pk_device, sk_device)</code>. The device key is under sole control of the holder.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">In the context of <span>[<a href="#EU2024-1183" class="cite xref">EU2024-1183</a>]</span>, this device is typically called a Wallet Secure Cryptographic Device (WSCD), running a personalised Wallet Secure Cryptographic Application (WSCA) that exposes a Secure Cryptographic Interface (SCI) to a Wallet Instance (WI) running on a User Device (UD). The WSCD is certified to protect access to the device private key with high attack potential resistance to achieve high level of assurance authentication as per <span>[<a href="#EU2015-1502" class="cite xref">EU2015-1502</a>]</span>. This typically means that the key is associated with a strong possession factor and with a rate-limited Personal Identification Number (PIN) check as a knowledge factor, and the verification of both factors actively involve the WSCD.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<p id="section-5.1-3">The HDK algorithm can support any of the following WSCD architectures:<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.1-4">
<li id="section-5.1-4.1">
            <p id="section-5.1-4.1.1">Local external standalone device, for example:<a href="#section-5.1-4.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-4.1.2.1">
                <p id="section-5.1-4.1.2.1.1">GlobalPlatform secure element, running for example a Java Card applet as WSCA for:<a href="#section-5.1-4.1.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-4.1.2.1.2.1">
                    <p id="section-5.1-4.1.2.1.2.1.1">Personal Identity Verification (PIV)<a href="#section-5.1-4.1.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-5.1-4.1.2.1.2.2">
                    <p id="section-5.1-4.1.2.1.2.2.1">Fast IDentity Online 2 (FIDO2)<a href="#section-5.1-4.1.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li id="section-5.1-4.2">
            <p id="section-5.1-4.2.1">Local internal standalone programmable cryptographic chip, for example:<a href="#section-5.1-4.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-4.2.2.1">
                <p id="section-5.1-4.2.2.1.1">Smartphone embedded universal integrated circuit card (eUICC), running for example a Subscriber Identity Module (SIM) as WSCA; also called eSIM<a href="#section-5.1-4.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-5.1-4.2.2.2">
                <p id="section-5.1-4.2.2.2.1">Smartphone embedded secure element (eSE), running for example a Java Card applet as WSCA<a href="#section-5.1-4.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li id="section-5.1-4.3">
            <p id="section-5.1-4.3.1">Local internal preprogammed security platform, for example:<a href="#section-5.1-4.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-4.3.2.1">
                <p id="section-5.1-4.3.2.1.1">Android trusted execution environment acting as WSCA<a href="#section-5.1-4.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-5.1-4.3.2.2">
                <p id="section-5.1-4.3.2.2.1">Android StrongBox secure element acting as WSCA<a href="#section-5.1-4.3.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-5.1-4.3.2.3">
                <p id="section-5.1-4.3.2.3.1">iOS Secure Enclave system-on-chip acting as WSCA<a href="#section-5.1-4.3.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-5.1-4.3.2.4">
                <p id="section-5.1-4.3.2.4.1">Trusted Platform Module (TPM) acting as WSCA<a href="#section-5.1-4.3.2.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li id="section-5.1-4.4">
            <p id="section-5.1-4.4.1">Remote HSM, for example:<a href="#section-5.1-4.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-4.4.2.1">
                <p id="section-5.1-4.4.2.1.1">Cryptographic module certified against EN 419221-5:2018 with a local client application acting as WSCA, remotely controlled for example using:<a href="#section-5.1-4.4.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-4.4.2.1.2.1">
                    <p id="section-5.1-4.4.2.1.2.1.1">PIV card as possession factor and PIN verification using a HSM-backed Device-Enhanced Augmented PAKE (an approach proposed by Sweden)<a href="#section-5.1-4.4.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-5.1-4.4.2.1.2.2">
                    <p id="section-5.1-4.4.2.1.2.2.1">Android/iOS security platform or standalone device, applying asymmetric cryptography to enable detection of remote HSM corruption as described in <span>[<a href="#SCAL3" class="cite xref">SCAL3</a>]</span><a href="#section-5.1-4.4.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
        </ol>
<p id="section-5.1-5">In all cases, the WSCD may implement a Cryptographic Service Provider <span>[<a href="#TR03181" class="cite xref">TR03181</a>]</span> to reduce the scope for Common Criteria certification of the WSCA.<a href="#section-5.1-5" class="pilcrow">¶</a></p>
<p id="section-5.1-6">The solution proposal discussed herein works in all four WSCD architectures that support the required cryptographic primitives within the WSCD:<a href="#section-5.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-7.1">
            <p id="section-5.1-7.1.1">In the case of HDK-ECDH-P256:<a href="#section-5.1-7.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-7.1.2.1">
                <p id="section-5.1-7.1.2.1.1">P-256 ECDH key pair generation<a href="#section-5.1-7.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-5.1-7.1.2.2">
                <p id="section-5.1-7.1.2.2.1">P-256 ECDH key agreement<a href="#section-5.1-7.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-5.1-7.2">
            <p id="section-5.1-7.2.1">In the case of HDK-ECSDSA-P256:<a href="#section-5.1-7.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-7.2.2.1">
                <p id="section-5.1-7.2.2.1.1">P-256 EC-SDSA key pair generation<a href="#section-5.1-7.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-5.1-7.2.2.2">
                <p id="section-5.1-7.2.2.2.1">P-256 EC-SDSA signature creation<a href="#section-5.1-7.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="section-5.1-8">The other HDK operations can be performed in the WI running on any UD, including hostile ones with limited sandboxing capabilities, such as in a smartphone's rich execution environment or in a personal computer web browser.<a href="#section-5.1-8" class="pilcrow">¶</a></p>
<p id="section-5.1-9">If the user enters the PIN in the WI instead of on the WSCD directly, the WI <span class="bcp14">MUST</span> process it directly after entering, the WI <span class="bcp14">MUST</span> keep the plaintext PIN confidential, and the WI <span class="bcp14">MUST</span> delete the PIN from memory as soon as the encrypted PIN or data derived from the PIN is passed over the SCI.<a href="#section-5.1-9" class="pilcrow">¶</a></p>
<p id="section-5.1-10">The rate-limiting of the PIN check <span class="bcp14">MUST</span> be managed within the WSCD or on securely managed SCI infrastructure. In particular, the rate-limiting <span class="bcp14">MUST NOT</span> be managed solely in local WI software since it is aassumed that attackers could modify this without detection.<a href="#section-5.1-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="trust-evidence">
<section id="section-5.2">
        <h3 id="name-trust-evidence">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-trust-evidence" class="section-name selfRef">Trust evidence</a>
        </h3>
<p id="section-5.2-1">Some issuers could require evidence from a solution provider of the security of the holder's cryptographic device. This evidence is in the context of <span>[<a href="#EU2024-1183" class="cite xref">EU2024-1183</a>]</span> divided into initial "Wallet Trust Evidence" and related "Issuer Trust Evidence". Each is a protected document that contains a trust evidence public key associated with a private key that is protected in the secure cryptographic device. In HDK, these public keys are specified as follows.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<div id="wallet-trust-evidence">
<section id="section-5.2.1">
          <h4 id="name-wallet-trust-evidence">
<a href="#section-5.2.1" class="section-number selfRef">5.2.1. </a><a href="#name-wallet-trust-evidence" class="section-name selfRef">Wallet Trust Evidence</a>
          </h4>
<p id="section-5.2.1-1">The Wallet Trust Evidence public key is the root HDK public key. To achieve reader unlinkability, the wallet <span class="bcp14">SHOULD</span> limit access to a trusted person identification document provider only.<a href="#section-5.2.1-1" class="pilcrow">¶</a></p>
<p id="section-5.2.1-2">To prevent association across identities, the solution provider <span class="bcp14">MUST</span> before issuing Wallet Trust Evidence ensure that the root HDK public key is associated with a newly generated device key pair. For example, the solution provider could rely on freshness of a key attestation and ensure that each device public key is attested only once.<a href="#section-5.2.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="issuer-trust-evidence">
<section id="section-5.2.2">
          <h4 id="name-issuer-trust-evidence">
<a href="#section-5.2.2" class="section-number selfRef">5.2.2. </a><a href="#name-issuer-trust-evidence" class="section-name selfRef">Issuer Trust Evidence</a>
          </h4>
<p id="section-5.2.2-1">The Issuer Trust Evidence public key can be any non-root HDK public key. The solution provider <span class="bcp14">MUST</span> verify that the wallet knows the associated private key before issuing Issuer Trust Evidence. The solution provider <span class="bcp14">MUST</span> ensure that <code>sk_device</code> is under sole control of the solution instance holder. To achieve reader unlinkability, the solution instance <span class="bcp14">MUST</span> limit access of Issuer Trust Evidence to a single issuer. Subsequent issuers within the same HDK tree do not need to receive any Issuer Trust Evidence, since they can derive equally secure keys by applying ARKG to presented keys attested by trusted (other) issuers.<a href="#section-5.2.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="applying-hdk-in-openid-for-verifiable-credential-issuance">
<section id="section-5.3">
        <h3 id="name-applying-hdk-in-openid-for-">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-applying-hdk-in-openid-for-" class="section-name selfRef">Applying HDK in OpenID for Verifiable Credential Issuance</a>
        </h3>
<p id="section-5.3-1">In <span>[<a href="#draft-OpenID4VCI" class="cite xref">draft-OpenID4VCI</a>]</span>, the following terminology applies:<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
          <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">OpenID4VCI</th>
              <th class="text-left" rowspan="1" colspan="1">HDK</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Credential</td>
              <td class="text-left" rowspan="1" colspan="1">attestation</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Credential Issuer</td>
              <td class="text-left" rowspan="1" colspan="1">issuer</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Verifier</td>
              <td class="text-left" rowspan="1" colspan="1">reader</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Wallet</td>
              <td class="text-left" rowspan="1" colspan="1">solution instance</td>
            </tr>
          </tbody>
        </table>
<p id="section-5.3-3">HDK enables solution instances and issuers cooperatively to establish the cryptographic key material that issued attestations will be bound to.<a href="#section-5.3-3" class="pilcrow">¶</a></p>
<p id="section-5.3-4">For asynchronous batch issuance, HDK proposes an update to the OpenID4VCI endpoints. This proposal is under discussion in <a href="https://github.com/openid/OpenID4VCI/issues/359">openid/OpenID4VCI#359</a>. In the update, the solution instance shares an ARKG public seed with the issuer, and the issuer shares a key handle for each attestation, generated using:<a href="#section-5.3-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-5">
<pre>
ARKG-Derive-Public-Key(key_generation_public_key, "")
</pre><a href="#section-5.3-5" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-6">
      <h2 id="name-security-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-security-considerations" class="section-name selfRef">Security considerations</a>
      </h2>
<div id="confidentiality-of-key-handles">
<section id="section-6.1">
        <h3 id="name-confidentiality-of-key-hand">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-confidentiality-of-key-hand" class="section-name selfRef">Confidentiality of key handles</a>
        </h3>
<p id="section-6.1-1">The key handles <span class="bcp14">MUST</span> be considered confidential, since they provide knowledge about the blinding factors. Compromise of this knowledge could introduce undesired linkability. In HDK, both the holder and the issuer know the key handle during issuance.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">In an alternative to HDK, the holder independently generates blinded key pairs and proofs of association, providing the issuer with zero knowledge about the blinding factors. However, this moves the problem: the proofs of association would now need to be considered confidential.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-combined-references">
<section id="section-7">
      <h2 id="name-references">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-7.1">
        <h3 id="name-normative-references">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="FIPS180-4">[FIPS180-4]</dt>
        <dd>
<span class="refAuthor">National Institute of Standards and Technology (NIST)</span>, <span class="refTitle">"Secure Hash Standard (SHS)"</span>, <span class="seriesInfo">FIPS 180-4</span>, <span class="seriesInfo">DOI 10.6028/NIST.FIPS.180-4</span>, <time datetime="2012-06" class="refDate">June 2012</time>, <span>&lt;<a href="https://csrc.nist.gov/pubs/fips/180-4/upd1/final">https://csrc.nist.gov/pubs/fips/180-4/upd1/final</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.draft-bradleylundberg-cfrg-arkg-02">[I-D.draft-bradleylundberg-cfrg-arkg-02]</dt>
        <dd>
<span class="refAuthor">Lundberg, E.</span> and <span class="refAuthor">J. Bradley</span>, <span class="refTitle">"The Asynchronous Remote Key Generation (ARKG) algorithm"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-bradleylundberg-cfrg-arkg-02</span>, <time datetime="2024-05-27" class="refDate">27 May 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-bradleylundberg-cfrg-arkg-02">https://datatracker.ietf.org/doc/html/draft-bradleylundberg-cfrg-arkg-02</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="ISO18013-5">[ISO18013-5]</dt>
        <dd>
<span class="refAuthor">ISO/IEC</span>, <span class="refTitle">"Personal identification - ISO-compliant driving licence - Part 5: Mobile driving licence (mDL) application"</span>, <span class="seriesInfo">ISO/IEC 18013-5:2021</span>, <time datetime="2019-09" class="refDate">September 2019</time>, <span>&lt;<a href="https://www.iso.org/standard/69084.html">https://www.iso.org/standard/69084.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7800">[RFC7800]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Bradley, J.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Proof-of-Possession Key Semantics for JSON Web Tokens (JWTs)"</span>, <span class="seriesInfo">RFC 7800</span>, <span class="seriesInfo">DOI 10.17487/RFC7800</span>, <time datetime="2016-04" class="refDate">April 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7800">https://www.rfc-editor.org/rfc/rfc7800</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8017">[RFC8017]</dt>
        <dd>
<span class="refAuthor">Moriarty, K., Ed.</span>, <span class="refAuthor">Kaliski, B.</span>, <span class="refAuthor">Jonsson, J.</span>, and <span class="refAuthor">A. Rusch</span>, <span class="refTitle">"PKCS #1: RSA Cryptography Specifications Version 2.2"</span>, <span class="seriesInfo">RFC 8017</span>, <span class="seriesInfo">DOI 10.17487/RFC8017</span>, <time datetime="2016-11" class="refDate">November 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8017">https://www.rfc-editor.org/rfc/rfc8017</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9380">[RFC9380]</dt>
        <dd>
<span class="refAuthor">Faz-Hernandez, A.</span>, <span class="refAuthor">Scott, S.</span>, <span class="refAuthor">Sullivan, N.</span>, <span class="refAuthor">Wahby, R. S.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Hashing to Elliptic Curves"</span>, <span class="seriesInfo">RFC 9380</span>, <span class="seriesInfo">DOI 10.17487/RFC9380</span>, <time datetime="2023-08" class="refDate">August 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9380">https://www.rfc-editor.org/rfc/rfc9380</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SEC2">[SEC2]</dt>
        <dd>
<span class="refAuthor">Certicom Research</span>, <span class="refTitle">"SEC 2: Recommended Elliptic Curve Domain Parameters, Version 2.0"</span>, <span class="seriesInfo">SEC 2 Version 2.0</span>, <time datetime="2010-01" class="refDate">January 2010</time>, <span>&lt;<a href="https://www.secg.org/sec2-v2.pdf">https://www.secg.org/sec2-v2.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TR03111">[TR03111]</dt>
      <dd>
<span class="refAuthor">Federal Office for Information Security (BSI)</span>, <span class="refTitle">"Elliptic Curve Cryptography"</span>, <span class="seriesInfo">BSI TR-03111 Version 2.10</span>, <time datetime="2018-06" class="refDate">June 2018</time>, <span>&lt;<a href="https://www.bsi.bund.de/EN/Themen/Unternehmen-und-Organisationen/Standards-und-Zertifizierung/Technische-Richtlinien/TR-nach-Thema-sortiert/tr03111/tr-03111.html">https://www.bsi.bund.de/EN/Themen/Unternehmen-und-Organisationen/Standards-und-Zertifizierung/Technische-Richtlinien/TR-nach-Thema-sortiert/tr03111/tr-03111.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-7.2">
        <h3 id="name-informative-references">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="BIP32">[BIP32]</dt>
        <dd>
<span class="refAuthor">Wuille, P.</span>, <span class="refTitle">"Hierarchical Deterministic Wallets"</span>, <span class="seriesInfo">BIP 32</span>, <time datetime="2021-02" class="refDate">February 2021</time>, <span>&lt;<a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki">https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="draft-OpenID4VCI">[draft-OpenID4VCI]</dt>
        <dd>
<span class="refAuthor">Lodderstedt, T.</span>, <span class="refAuthor">Yasuda, K.</span>, and <span class="refAuthor">T. Looker</span>, <span class="refTitle">"OpenID for Verifiable Credential Issuance, draft 13"</span>, <time datetime="2024-02-08" class="refDate">8 February 2024</time>, <span>&lt;<a href="https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html">https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="EU2015-1502">[EU2015-1502]</dt>
        <dd>
<span class="refAuthor">European Commission</span>, <span class="refTitle">"Commission Implementing Regulation (EU) 2015/1502 of 8 September 2015 on setting out minimum technical specifications and procedures for assurance levels for electronic identification means"</span>, <span class="seriesInfo">(EU) 2015/1502</span>, <time datetime="2025-09" class="refDate">September 2025</time>, <span>&lt;<a href="https://eur-lex.europa.eu/legal-content/TXT/?uri=CELEX%3A32015R1502">https://eur-lex.europa.eu/legal-content/TXT/?uri=CELEX%3A32015R1502</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="EU2024-1183">[EU2024-1183]</dt>
        <dd>
<span class="refAuthor">The European Parliament and the Council of the European Union</span>, <span class="refTitle">"Amending Regulation (EU) No 910/2014 as regards establishing the European Digital Identity Framework"</span>, <span class="seriesInfo">(EU) 2024/1183</span>, <time datetime="2024-04" class="refDate">April 2024</time>, <span>&lt;<a href="https://data.europa.eu/eli/reg/2024/1183/oj">https://data.europa.eu/eli/reg/2024/1183/oj</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SCAL3">[SCAL3]</dt>
        <dd>
<span class="refAuthor">Cleverbase ID B.V.</span>, <span class="refTitle">"SCAL3: Verify that systems operate under your sole control, version de8c5ae"</span>, <time datetime="2024-03" class="refDate">March 2024</time>, <span>&lt;<a href="https://github.com/cleverbase/scal3">https://github.com/cleverbase/scal3</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TR03181">[TR03181]</dt>
      <dd>
<span class="refAuthor">Federal Office for Information Security (BSI)</span>, <span class="refTitle">"Cryptographic Service Provider 2 (CSP2)"</span>, <span class="seriesInfo">BSI TR-03181 Version 0.94</span>, <time datetime="2023-04" class="refDate">April 2023</time>, <span>&lt;<a href="https://www.bsi.bund.de/EN/Themen/Unternehmen-und-Organisationen/Standards-und-Zertifizierung/Technische-Richtlinien/TR-nach-Thema-sortiert/tr03181/TR-03181_node.html">https://www.bsi.bund.de/EN/Themen/Unternehmen-und-Organisationen/Standards-und-Zertifizierung/Technische-Richtlinien/TR-nach-Thema-sortiert/tr03181/TR-03181_node.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="acknowledgements">
<section id="appendix-A">
      <h2 id="name-acknowledgements">
<a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="appendix-A-1">This design is based on ideas introduced to the EU Digital Identity domain by Peter Lee Altmann.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2">Helpful feedback came from Emil Lundberg and Remco Schaar.<a href="#appendix-A-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Sander Dijkhuis (<span class="role">editor</span>)</span></div>
<div dir="auto" class="left"><span class="org">Cleverbase</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mail@sanderdijkhuis.nl" class="email">mail@sanderdijkhuis.nl</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
